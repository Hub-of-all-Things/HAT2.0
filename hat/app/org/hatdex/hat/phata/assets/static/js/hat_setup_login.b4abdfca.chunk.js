(this["webpackJsonprumpel-react"]=this["webpackJsonprumpel-react"]||[]).push([[5],{192:function(e,n,t){"use strict";t.r(n);var a=t(0),c=t.n(a),r=t(44),i=t(13),o=t(42),l=t(90),u=function(e){var n=Object(i.c)();return Object(a.useEffect)((function(){var e,t=null===(e=Object(l.a)("name"))||void 0===e?void 0:e.toLowerCase(),a=Object(l.a)("redirect");n(t?a?Object(r.c)(t):Object(o.e)("application_misconfigured","redirect_is_required "):Object(o.e)("application_misconfigured","name_is_required "))}),[n]),c.a.createElement(c.a.Fragment,null,e.children)},d=t(94),p=t(18),s=t(126),f=function(){var e=Object(i.c)(),n=Object(i.d)(p.c);return c.a.createElement(c.a.Fragment,null,c.a.createElement(s.a,{registrationType:d.a.daas,nextStep:function(){return e(Object(o.b)((null===n||void 0===n?void 0:n.application.id)||""))},cancelStep:function(){return e(Object(o.c)())}}))},v=t(128),b=t(45),O=function(){var e=Object(i.d)(p.c);return!e||e.setup?c.a.createElement(b.a,{loadingText:"Loading permissions"}):c.a.createElement("div",null,c.a.createElement(v.a,{hmiType:d.a.daas}),c.a.createElement(f,null))},j=function(e){var n=Object(i.d)(o.d);return Object(a.useEffect)((function(){var e=function(e,n){var t=Object(l.a)("redirect")||Object(l.a)("fallback");return"".concat(t,"?error=").concat(e,"%26error_reason=").concat(n).replace("#","%23")};if(n&&n.error){var t=Object(l.a)("fallback"),a="true"===Object(l.a)("internal");window.location.href=a&&t||e(n.error,n.errorReason)}}),[n]),c.a.createElement(c.a.Fragment,null,e.children)},m=function(e){var n=Object(i.d)(r.d),t=Object(i.c)();return Object(a.useEffect)((function(){if(n&&n.length>0){var e=Object(l.a)("name"),a=n.find((function(n){return n.application.id===e}));if(!a||"App"!==a.application.kind.kind)return void t(Object(o.e)("application_misconfigured","application_id_not_found "));var c=a.application.setup.dependencies||[];t(Object(p.e)(a)),t(Object(p.d)(n.filter((function(e){return c.indexOf(e.application.id)>-1}))))}}),[n,t]),c.a.createElement(c.a.Fragment,null,e.children)},h=t(1),w=t.n(h),g=t(3),E=t(7),k=t(23),_=function(e){var n=Object(i.d)(p.c),t=Object(i.d)(p.b);return Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(w.a.mark((function e(n){var t,a,c,r,i,o,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="true"===Object(l.a)("internal"),a=Object(l.a)("redirect"),!t){e.next=6;break}window.location.href=a||"",e.next=16;break;case 6:return c=E.a.getInstance(),e.prev=7,e.next=10,c.appLogin(n.application.id);case 10:(null===(i=e.sent)||void 0===i||null===(r=i.parsedBody)||void 0===r?void 0:r.accessToken)&&(o=i.parsedBody.accessToken,u=n.application.setup,[u.url,u.iosUrl,u.androidUrl,u.testingUrl].includes(decodeURI(a||""))?window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","token=").concat(o):(console.warn("Provided URL is not registered"),c.sendReport("hmi_invalid_redirect_url","".concat(n.application.id,": ").concat(a)).finally((function(){k.a.sandbox?window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","token=").concat(o):window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","error=access_denied&error_reason=hmi_invalid_redirect_url")})))),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(n){return e.apply(this,arguments)}}();n&&n.setup&&t.every((function(e){return!0===e.enabled}))&&e(n)}),[n,t]),c.a.createElement(c.a.Fragment,null,e.children)},x=function(e){var n=Object(i.d)(p.c),t=Object(i.d)(p.b);return Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(w.a.mark((function e(n){var t,c,r,i,o,l;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.filter((function(e){return!e.enabled}))[0],c=a(t.application.id),e.prev=2,r=E.a.getInstance(),e.next=6,r.setupApplication(t.application.id);case 6:if(!(null===(i=e.sent)||void 0===i?void 0:i.parsedBody)){e.next=12;break}return e.next=10,r.appLogin(t.application.id);case 10:(null===(l=e.sent)||void 0===l||null===(o=l.parsedBody)||void 0===o?void 0:o.accessToken)&&(window.location.href="".concat(t.application.setup.url,"?token=").concat(l.parsedBody.accessToken,"&redirect=").concat(c));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.log("Setup dependencies errored",e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(n){return e.apply(this,arguments)}}(),a=function(e){var n,a=window.location.href.split("?")[0],c=null===(n=Object(l.a)("name"))||void 0===n?void 0:n.toLowerCase(),r=Object(l.a)("redirect"),i=Object(l.a)("dependencies");if(a+="?name=".concat(c,"%26redirect=").concat(r),i){var o=i.split(",").filter((function(n){return n!==e}));o&&o.length>0&&(a+="%26dependencies=".concat(o.join()))}else if(t){var u=t.filter((function(n){return n.application.id!==e})).map((function(e){return e.application.id}));u&&u.length>0&&(a+="%26dependencies=".concat(u.join()))}return a.replace("#","%23")};n&&n.setup&&!t.every((function(e){return!0===e.enabled}))&&e(t)}),[n,t]),c.a.createElement(c.a.Fragment,null,e.children)};n.default=function(){return c.a.createElement(u,null,c.a.createElement(m,null,c.a.createElement(_,null,c.a.createElement(x,null,c.a.createElement(j,null,c.a.createElement(O,null))))))}}}]);
//# sourceMappingURL=hat_setup_login.b4abdfca.chunk.js.map