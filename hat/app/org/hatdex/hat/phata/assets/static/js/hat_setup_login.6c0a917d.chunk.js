(this["webpackJsonprumpel-react"]=this["webpackJsonprumpel-react"]||[]).push([[5],{144:function(e,n,t){},177:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(44),i=t(13),o=t(42),l=t(91),d=function(e){var n=Object(i.c)();return Object(a.useEffect)((function(){var e=Object(l.a)("application_id")||Object(l.a)("name"),t=null===e||void 0===e?void 0:e.toLowerCase();Object(l.a)("redirect_uri")||Object(l.a)("redirect")?n(t?Object(c.c)(t):Object(o.e)("application_misconfigured","application_id_is_required ")):n(Object(o.e)("application_misconfigured","redirect_is_required "))}),[n]),r.a.createElement(r.a.Fragment,null,e.children)},u=t(94),p=t(17),s=t(118),f=function(){var e=Object(i.c)(),n=Object(i.d)(p.c);return r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{registrationType:u.a.daas,nextStep:function(){return e(Object(o.b)((null===n||void 0===n?void 0:n.application.id)||""))},cancelStep:function(){return e(Object(o.c)())}}))},b=t(120),v=t(45),m=function(){var e=Object(i.d)(p.c);return!e||e.setup?r.a.createElement(v.a,{loadingText:"Loading permissions"}):r.a.createElement("div",null,r.a.createElement(b.a,{hmiType:u.a.daas}),r.a.createElement(f,null))},O=t(90),j=t(23),h=function(e){var n=Object(a.useState)(!1),t=Object(O.a)(n,2),c=t[0],d=t[1],u=Object(i.d)(o.d);Object(a.useEffect)((function(){if(u&&u.error){var e=Object(l.a)("fallback"),n="true"===Object(l.a)("internal"),t=function(e,n){var t=Object(l.a)("redirect_uri")||Object(l.a)("fallback")||Object(l.a)("redirect");return t?"".concat(t,"?error=").concat(e,"%26error_reason=").concat(n).replace("#","%23"):null}(u.error,u.errorReason);if(!t)return void d(!0);window.location.href=n&&e||t}}),[u]);var p=function(){return j.a.sandbox?r.a.createElement("div",null,r.a.createElement("div",{className:"app-error"},r.a.createElement("h3",{className:"app-error-header"},"Ooops... Looks like something went wrong."),r.a.createElement("p",{className:"app-error-text"},'ERROR: App details incorrect. "redirect_uri" query parameter is missing. ',r.a.createElement("br",null),r.a.createElement("a",{href:"https://docs.dataswift.io/guides/hat-login/02-send-hat-login",target:"_blank",rel:"noopener noreferrer"},"Learn more")))):r.a.createElement("div",null,r.a.createElement("div",{className:"app-error"},r.a.createElement("h3",{className:"app-error-header"},"Ooops... Looks like something went wrong."),r.a.createElement("p",{className:"app-error-text"},"ERROR: App details incorrect. Please contact the app developer and let them know.")))};return r.a.createElement(r.a.Fragment,null,c?r.a.createElement(p,null):e.children)},E=function(e){var n=Object(i.d)(c.d),t=Object(i.c)();return Object(a.useEffect)((function(){if(n&&n.length>0){var e=Object(l.a)("application_id")||Object(l.a)("name"),a=null===e||void 0===e?void 0:e.toLowerCase(),r=n.find((function(e){return e.application.id===a}));if(!r||"App"!==r.application.kind.kind)return void t(Object(o.e)("application_misconfigured","application_id_not_found "));var c=r.application.setup.dependencies||[];t(Object(p.e)(r)),t(Object(p.d)(n.filter((function(e){return c.indexOf(e.application.id)>-1}))))}}),[n,t]),r.a.createElement(r.a.Fragment,null,e.children)},g=t(1),w=t.n(g),_=t(3),k=t(6),x=function(e){var n=Object(i.d)(p.c),t=Object(i.d)(p.b);return Object(a.useEffect)((function(){var e=function(){var e=Object(_.a)(w.a.mark((function e(n){var t,a,r,c,i,o,d;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="true"===Object(l.a)("internal"),a=Object(l.a)("redirect_uri")||Object(l.a)("redirect"),!t){e.next=6;break}window.location.href=a||"",e.next=16;break;case 6:return r=k.a.getInstance(),e.prev=7,e.next=10,r.appLogin(n.application.id);case 10:(null===(i=e.sent)||void 0===i||null===(c=i.parsedBody)||void 0===c?void 0:c.accessToken)&&(o=i.parsedBody.accessToken,d=n.application.setup,[d.url,d.iosUrl,d.androidUrl,d.testingUrl].includes(decodeURI(a||""))?window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","token=").concat(o):(console.warn("Provided URL is not registered"),r.sendReport("hmi_invalid_redirect_url","".concat(n.application.id,": ").concat(a)).finally((function(){j.a.sandbox?window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","token=").concat(o):window.location.href="".concat(a).concat(-1!==(null===a||void 0===a?void 0:a.indexOf("?"))?"&":"?","error=access_denied&error_reason=hmi_invalid_redirect_url")})))),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(n){return e.apply(this,arguments)}}();n&&n.setup&&t.every((function(e){return!0===e.enabled}))&&e(n)}),[n,t]),r.a.createElement(r.a.Fragment,null,e.children)},y=function(e){var n=Object(i.d)(p.c),t=Object(i.d)(p.b);return Object(a.useEffect)((function(){var e=function(){var e=Object(_.a)(w.a.mark((function e(n){var t,r,c,i,o,l;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.filter((function(e){return!e.enabled}))[0],r=a(t.application.id),e.prev=2,c=k.a.getInstance(),e.next=6,c.setupApplication(t.application.id);case 6:if(!(null===(i=e.sent)||void 0===i?void 0:i.parsedBody)){e.next=12;break}return e.next=10,c.appLogin(t.application.id);case 10:(null===(l=e.sent)||void 0===l||null===(o=l.parsedBody)||void 0===o?void 0:o.accessToken)&&(window.location.href="".concat(t.application.setup.url,"?token=").concat(l.parsedBody.accessToken,"&redirect=").concat(r));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.log("Setup dependencies errored",e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(n){return e.apply(this,arguments)}}(),a=function(e){var n,a=window.location.href.split("?")[0],r=null===(n=Object(l.a)("name"))||void 0===n?void 0:n.toLowerCase(),c=Object(l.a)("redirect"),i=Object(l.a)("dependencies");if(a+="?name=".concat(r,"%26redirect=").concat(c),i){var o=i.split(",").filter((function(n){return n!==e}));o&&o.length>0&&(a+="%26dependencies=".concat(o.join()))}else if(t){var d=t.filter((function(n){return n.application.id!==e})).map((function(e){return e.application.id}));d&&d.length>0&&(a+="%26dependencies=".concat(d.join()))}return a.replace("#","%23")};n&&n.setup&&!t.every((function(e){return!0===e.enabled}))&&e(t)}),[n,t]),r.a.createElement(r.a.Fragment,null,e.children)};t(144),n.default=function(){return r.a.createElement(d,null,r.a.createElement(E,null,r.a.createElement(x,null,r.a.createElement(y,null,r.a.createElement(h,null,r.a.createElement(m,null))))))}}}]);
//# sourceMappingURL=hat_setup_login.6c0a917d.chunk.js.map